<!-- 
  ProxyFatturaPA - Gestione del formato Fattura Elettronica 
  http://www.gov4j.it/fatturapa
  
  Copyright (c) 2014-2015 Link.it srl (http://link.it). 
  Copyright (c) 2014-2015 Provincia Autonoma di Bolzano (http://www.provincia.bz.it/). 
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
 
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
 
  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE ui:composition
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:a4j="http://richfaces.org/a4j" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:rich="http://richfaces.org/rich" xmlns:op2web="http://www.openspcoop2.org/web/taglib/jsf2" template="/templates/defaultTemplate.xhtml">
	<f:loadBundle var="msg" basename="messages"/>
	<h:outputScript xmlns="" name="resource://jquery.js"/>

	<ui:define name="pageTitle">#{msg['fattura.listaFatture.pageTitle']}</ui:define>
	<ui:define name="pageHeader">#{msg['fattura.listaFatture.pageTitle']}</ui:define>
	<ui:define name="navbar">
		<ul>
			<li><h:outputText value="/#{msg['menu.group.operazioni']}"/></li>
			<li><h:outputText value="/#{msg['fattura.listaFatture.pageTitle']}"/></li>
		</ul>
	</ui:define>
	<ui:define name="body">
		<rich:panel styleClass="noborder" id="pagina">
			<op2web:search mBean="#{fatturaElettronicaMBean}" fieldsToUpdateButtonFiltra="panelFatture" fieldsToUpdateButtonReset="panelFatture">
				
				<op2web:fieldset legend="#{msg['fattura.search.datiTrasmissione']}" rendered="#{true}" collapsible="false" closed="false">
					<op2web:searchFields nomiFields="#{'cedentePrestatore,identificativoLotto,dipartimento,dataRicezionePeriodo,dataRicezione'}"/>
				</op2web:fieldset>
					
				<op2web:fieldset legend="#{msg['fattura.search.datiFattura']}" rendered="#{true}" collapsible="false" closed="false">
					<op2web:searchFields nomiFields="#{'numero,dataEsatta,tipoDocumento'}"/>
				</op2web:fieldset>
					
				<op2web:fieldset legend="#{msg['fattura.search.statoFattura']}" rendered="#{true}" collapsible="false" closed="false">
					<op2web:searchFields nomiFields="#{'notificaEsitoCommittente,notificaDecorrenzaTermini'}"/>
				</op2web:fieldset>
			</op2web:search>
	
			<h:panelGroup xmlns="" layout="block" styleClass="spacer"/>
			
			<op2web:managedPagedListView value="#{fatturaElettronicaDM}" mBean="#{fatturaElettronicaMBean}" styleClass="fullWidth">
				
				<!-- Colonne mittente,destinatario,identificativoSDI, annonumero, data, dataricezione, importo -->
				<op2web:tableColumns nomiColonne="#{'cedentePrestatore,dipartimento,identificativoSdi,annoNumero,data,dataRicezione,importo'}"/>
				
				<!-- Notifica EC (Icona) -->
				<rich:column style="text-align: center;">
					<f:facet name="header">
						<h:outputText value="#{itemMetadata.notificaEC.label}"/>
					</f:facet>
					 
					<h:panelGroup>
						<h:graphicImage xmlns="" width="16" height="16" title="#{item.notificaEC.title}" alt="" rendered="#{empty item.notificaEC.href}" value="#{item.notificaEC.image}"/>
					
						<a4j:commandLink id="notificaEC_btn" action="inviaNotificaEC" rendered="#{not empty item.notificaEC.href}" execute="@this">
							<a4j:param assignTo="#{notificaECMBean.selectedIdParam}" name="#{notificaECMBean.selectedIdParamName}" value="#{item.DTO.id}" />
							<a4j:param assignTo="#{notificaECMBean.fromPage}" name="fromPage" value="listaFatture" />
							<h:graphicImage xmlns="" width="16" height="16" title="#{item.notificaEC.title}" alt="" value="#{item.notificaEC.image}"/>
						</a4j:commandLink>
					</h:panelGroup>
				</rich:column>
					
					<!-- Notifica DT (Icona) -->
				<rich:column style="text-align: center;">
					<f:facet name="header">
						<h:outputText value="#{itemMetadata.notificaDT.label}"/>
					</f:facet>
					 
					<h:panelGroup>
						<h:graphicImage xmlns="" width="16" alt="" height="16" title="#{item.notificaDT.title}" rendered="#{item.notificaDT.rendered == true}" value="#{item.notificaDT.image}"/>
						<h:graphicImage xmlns="" width="1" height="1" alt="s.gif" rendered="#{item.notificaDT.rendered == false}" library="images" name="s.gif"/>
					</h:panelGroup>
				</rich:column>
				
				<!-- XML (Icona) -->
				<rich:column style="text-align: center;">
					<f:facet name="header">
						<h:outputText value="#{itemMetadata.xml.label}"/>
					</f:facet>
					 
					<h:panelGroup>
					 	<h:commandLink id="visualizzaXmlLink" target="_blank" action="#{item.visualizzaXml}" rendered="#{not empty item.xml.href}">
							<h:graphicImage xmlns="" width="16" alt="" height="16" title="#{item.xml.title}" value="#{item.xml.image}"/>
						</h:commandLink>
					</h:panelGroup>
				</rich:column>
				
				<!-- PDF (Icona) -->
				<rich:column style="text-align: center;">
					<f:facet name="header">
						<h:outputText value="#{itemMetadata.pdf.label}"/>
					</f:facet>
					 <h:panelGroup>
					 	<h:commandLink id="visualizzaPdfLink" target="_blank" action="#{item.visualizzaPdf}" rendered="#{not empty item.pdf.href}">
							<h:graphicImage xmlns="" width="16" height="16" title="#{item.pdf.title}" alt="" value="#{item.pdf.image}"/>
						</h:commandLink>
					</h:panelGroup>
				</rich:column>
				
				<!-- Link dettagli -->
				<rich:column style="text-align: center;">
					<h:panelGroup>
						<a4j:commandLink id="dettaglio_btn" action="dettaglio" execute="@this">
							<a4j:param assignTo="#{fatturaElettronicaMBean.selectedIdParam}" name="#{fatturaElettronicaMBean.selectedIdParamName}" value="#{item.DTO.id}" />
							<h:graphicImage xmlns="" width="16" alt="magnifier.png" height="16" title="#{msg['fattura.label.ricercaFatture.dettaglioTitle']}" library="images" name="magnifier.png"/>
						</a4j:commandLink>
					</h:panelGroup>
				</rich:column>
				
				<ui:define name="buttonsListView">
					<h:commandLink id="exportFatture-iconLink" target="_blank" styleClass="icon-compress" action="#{fatturaElettronicaMBean.exportSelected}" onclick="return checkSelection('fatturaElettronicaTable');" style="color: #dd2c0d">
						<h:outputText value="#{msg['commons.button.esporta']}"/>
					</h:commandLink>
				</ui:define>
			</op2web:managedPagedListView>
		</rich:panel>
	</ui:define>
</ui:composition>
