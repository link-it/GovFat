<!-- 
  ProxyFatturaPA - Gestione del formato Fattura Elettronica 
  http://www.gov4j.it/fatturapa
  
  Copyright (c) 2014-2015 Link.it srl (http://link.it). 
  Copyright (c) 2014-2015 Provincia Autonoma di Bolzano (http://www.provincia.bz.it/). 
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
 
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
 
  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!DOCTYPE ui:composition
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:a4j="http://richfaces.org/a4j" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:rich="http://richfaces.org/rich" xmlns:op2web="http://www.openspcoop2.org/web/taglib/jsf2" template="/templates/defaultTemplate.xhtml">
	<f:loadBundle var="msg" basename="messages"/>

	<ui:define name="pageTitle">#{msg['fattura.dettaglio.pageTitle']}</ui:define>
	<ui:define name="pageHeader">#{msg['fattura.dettaglio.pageTitle']}</ui:define>
	<ui:define name="navbar">
		<ul>
			<li><h:outputText value="/#{msg['menu.group.operazioni']}"/></li>
			<li><a4j:commandLink action="#{fatturaElettronicaMBean.restoreSearch}" value="/#{msg['fattura.listaFatture.pageTitle']}">
				</a4j:commandLink></li>
			<li><h:outputText value="/#{msg['fattura.dettaglio.pageTitle']} (#{fatturaElettronicaMBean.selectedElement.cedentePrestatore.value} #{fatturaElettronicaMBean.selectedElement.numero.value}/#{fatturaElettronicaMBean.selectedElement.anno.value})"/></li>
		</ul>
	</ui:define>
	<ui:define name="body">

		<rich:panel id="panelContainer1" style="padding:0" headerClass="outpanelHeader" styleClass="noborder">
			<h:outputText id="outNoDettaglio" value="#{msg['fattura.dettaglio.nodata']}" rendered="#{empty fatturaElettronicaMBean.selectedElement}"/>

			<rich:panel id="panelDettaglio1" bodyClass="inpanelBody" rendered="#{not empty fatturaElettronicaMBean.selectedElement}">
				<f:facet name="header">
					<h:outputText id="outHeaderFattura1" value="#{msg['fattura.dettaglio.pageTitle']} (#{fatturaElettronicaMBean.selectedElement.cedentePrestatore.value} #{fatturaElettronicaMBean.selectedElement.numero.value}/#{fatturaElettronicaMBean.selectedElement.anno.value})" rendered="#{not empty fatturaElettronicaMBean.selectedElement}"/>
				</f:facet>

				<!-- Messaggio Idp -->
				<h:panelGrid id="panelDettaglio2" columnClasses="gridContent verticalAlignTop" rendered="#{!empty fatturaElettronicaMBean.selectedElement}" columns="1" width="100%">

					<!-- Dati Intestazione  -->
					<op2web:fieldset legend="#{msg['fattura.label.intestazione']}" collapsible="false" closed="false" rendered="#{true}">
						<op2web:outputGroup group="#{fatturaElettronicaMBean.selectedElement.datiIntestazione}"/>
					</op2web:fieldset>

					<!-- Dati Trasmissione  -->
					<op2web:fieldset legend="#{msg['fattura.label.generale']}" collapsible="false" closed="false" rendered="#{true}">
						<op2web:outputGroup group="#{fatturaElettronicaMBean.selectedElement.datiTrasmissione1}"/>
					</op2web:fieldset>

					<!-- Contenuto Fattura -->
					<op2web:fieldset legend="#{msg['fattura.label.contenuto']}" collapsible="false" closed="false" rendered="#{true}">
						<op2web:outputGroup group="#{fatturaElettronicaMBean.selectedElement.contenutoFattura}"/>
					</op2web:fieldset>

					<!-- Tabella Allegati -->
					<op2web:fieldset legend="#{msg['fattura.label.allegati']}" collapsible="false" closed="false" rendered="#{true}">
						<c:set var="metadataAllegato" value="#{fatturaElettronicaMBean.selectedElement.metadataAllegato}"/>

						<c:set var="listaAllegati" value="#{fatturaElettronicaMBean.selectedElement.allegati}"/>

						<h:outputText id="outNoListaAllegati" value="#{msg['fattura.label.allegati.nodata']}" rendered="#{empty listaAllegati}"/>

						<op2web:simpleListView id="tabellaAllegati" rendered="#{not empty listaAllegati}" value="#{listaAllegati}" itemMetadata="#{metadataAllegato}">
						
							<!-- Colonne nome,descrizione,compressione,formato-->
							<op2web:tableColumns nomiColonne="#{'nomeAttachment,descrizioneAttachment,algoritmoCompressione,formatoAttachment'}"/>
							
							<!-- Visualizza -->
							<rich:column style="text-align: center;">
								<f:facet name="header">
									<h:outputText value="#{metadataAllegato.attachment.label}"/>
								</f:facet>

								<h:panelGroup>
									<h:outputLink value="#{item.attachment.href}" target="_blank" rendered="#{not empty item.attachment.href}">
										<h:graphicImage xmlns="" width="16" height="16" title="#{item.attachment.title}" library="default" name="#{item.attachment.image}" alt=""/>
									</h:outputLink>
								</h:panelGroup>
							</rich:column>
						</op2web:simpleListView>
					</op2web:fieldset>

					<!-- Notifica di Esito Committente -->
					<op2web:fieldset legend="#{msg['fattura.label.notificaEC']}" collapsible="false" closed="false" rendered="#{true}">
						<c:set var="metadataNotificaEC" value="#{fatturaElettronicaMBean.selectedElement.metadataNotificaEC}"/>
 
 						<c:set var="listaNotificaEC" value="#{fatturaElettronicaMBean.selectedElement.listaNotificaEC}"/>

						<h:outputText id="outNoListaNotificaEC" value="#{msg['fattura.label.notificaEC.nodata']}" rendered="#{empty listaNotificaEC}"/>

						<h:panelGrid  columns="2" columnClasses="">
						
						<op2web:simpleListView id="tabellaNotificaEC" rendered="#{not empty listaNotificaEC}" value="#{listaNotificaEC}" itemMetadata="#{metadataNotificaEC}">
								
									<!-- Colonne esito,datainvioente,datainviosdi,utente,modalitabatch,descrizione-->
									<op2web:tableColumns nomiColonne="#{'esito,dataInvio,data,utente,modalitaBatch,descrizione'}"/>
									
									<!-- XML (Icona) -->
									<rich:column style="text-align: center;">
										<f:facet name="header">
											<h:outputText value="#{metadataNotificaEC.xml.label}"/>
										</f:facet>
		
										<h:panelGroup>
											<h:outputLink value="#{item.xml.href}" target="_blank" rendered="#{not empty item.xml.href}">
												<h:graphicImage xmlns="" width="16" height="16" title="#{item.xml.title}" library="default" name="#{item.xml.image}" alt=""/>
											</h:outputLink>
										</h:panelGroup>
									</rich:column>
		
									<!-- PDF (Icona) -->
									<rich:column style="text-align: center;">
										<f:facet name="header">
											<h:outputText value="#{metadataNotificaEC.pdf.label}"/>
										</f:facet>
		
										<h:panelGroup>
											<h:outputLink value="#{item.pdf.href}" target="_blank" rendered="#{not empty item.pdf.href}">
												<h:graphicImage xmlns="" width="16" height="16" title="#{item.pdf.title}" library="default" name="#{item.pdf.image}" alt=""/>
											</h:outputLink>
										</h:panelGroup>
									</rich:column>
									
								</op2web:simpleListView>
								
									<op2web:simpleListView id="tabellaNotificaEC2" rendered="#{not empty listaNotificaEC}" value="#{listaNotificaEC}" itemMetadata="#{metadataNotificaEC}">
							
									<!-- Colonne Scarto, Note Scarto -->
									<op2web:tableColumns nomiColonne="#{'scarto,scartoNote'}"/>
									
									<!-- Scarto XML (Icona) -->
									<rich:column style="text-align: center;">
										<f:facet name="header">
											<h:outputText value="#{metadataNotificaEC.scartoXml.label}"/>
										</f:facet>
		
										<h:panelGroup>
											<h:outputLink value="#{item.scartoXml.href}" target="_blank" rendered="#{not empty item.scartoXml.href}">
												<h:graphicImage xmlns="" width="16" height="16" title="#{item.scartoXml.title}" library="default" name="#{item.scartoXml.image}" alt=""/>
											</h:outputLink>
										</h:panelGroup>
									</rich:column>

									<!-- SCarto PDF (Icona) -->
									<rich:column style="text-align: center;">
										<f:facet name="header">
											<h:outputText value="#{metadataNotificaEC.scartoPdf.label}"/>
										</f:facet>
		
										<h:panelGroup>
											<h:outputLink value="#{item.scartoPdf.href}" target="_blank" rendered="#{not empty item.scartoPdf.href}">
												<h:graphicImage xmlns="" width="16" height="16" title="#{item.scartoPdf.title}" library="default" name="#{item.scartoPdf.image}" alt=""/>
											</h:outputLink>
										</h:panelGroup>
									</rich:column>
		
								</op2web:simpleListView>
						</h:panelGrid>
					</op2web:fieldset>

					<!-- Notifica Decorrenza Termini -->
					<op2web:fieldset legend="#{msg['fattura.label.notificaDT']}" collapsible="false" closed="false" rendered="#{true}">
						<c:set var="metadataNotificaDT" value="#{fatturaElettronicaMBean.selectedElement.metadataNotificaDT}"/>

						<c:set var="listaNotificaDT" value="#{fatturaElettronicaMBean.selectedElement.listaNotificaDT}"/>

						<h:outputText id="outNoListaNotificaDT" value="#{msg['fattura.label.notificaDT.nodata']}" rendered="#{empty listaNotificaDT}"/>

						<op2web:simpleListView id="tabellaNotificaDT" value="#{listaNotificaDT}" rendered="#{not empty listaNotificaDT}" itemMetadata="#{metadataNotificaDT}">
						
							<!-- Data Ricezione, Nome File, Descrizione, Note -->
							<op2web:tableColumns nomiColonne="#{'dataRicezione,nomeFile,descrizione,note'}"/>

							<!-- XML (Icona) -->
							<rich:column style="text-align: center;">
								<f:facet name="header">
									<h:outputText value="#{metadataNotificaDT.xml.label}"/>
								</f:facet>

								<h:panelGroup>
									<h:outputLink value="#{item.xml.href}" target="_blank" rendered="#{not empty item.xml.href}">
										<h:graphicImage xmlns="" width="16" height="16" title="#{item.xml.title}" library="default" name="${item.xml.image}" alt=""/>
									</h:outputLink>
								</h:panelGroup>
							</rich:column>

							<!-- PDF (Icona) -->
							<rich:column style="text-align: center;">
								<f:facet name="header">
									<h:outputText value="#{metadataNotificaDT.pdf.label}"/>
								</f:facet>

								<h:panelGroup>
									<h:outputLink value="#{item.pdf.href}" target="_blank" rendered="#{not empty item.pdf.href}">
										<h:graphicImage xmlns="" width="16" height="16" title="#{item.pdf.title}" library="default" name="${item.pdf.image}" alt=""/>
									</h:outputLink>
								</h:panelGroup>
							</rich:column>

						</op2web:simpleListView>
					</op2web:fieldset>

				</h:panelGrid>

				<h:panelGroup xmlns="" layout="block" styleClass="spacer"/>
				<div class="buttonrow">
					<h:form>
						<!-- Visualizza XML -->
						<c:set var="linkXml" value="#{fatturaElettronicaMBean.selectedElement.xml}"/>
							
						<h:outputLink styleClass="buttonNoRed" id="visualizzaXmlLink" target="_blank" value="#{linkXml.href}" rendered="#{not empty linkXml.href}">
							<h:graphicImage xmlns="" alt="" width="16" height="16" title="#{linkXml.title}" value="#{linkXml.image}"/>
							<h:outputText value="#{msg['commons.label.visualizza']} #{linkXml.label}"/>
						</h:outputLink>
						
						<!-- Visualizza PDF -->
						<c:set var="linkPdf" value="#{fatturaElettronicaMBean.selectedElement.pdf}"/>

						<h:outputLink styleClass="buttonNoRed" id="visualizzaPdfLink" target="_blank" value="#{linkPdf.href}" rendered="#{not empty linkPdf.href}">
							<h:graphicImage xmlns="" alt="" width="16" height="16" title="#{linkPdf.title}" value="#{linkPdf.image}"/>
							<h:outputText value="#{msg['commons.label.visualizza']} #{linkPdf.label}"/>
						</h:outputLink>
						
						<!-- Scarica Tutto -->
						<c:set var="linkZip" value="#{fatturaElettronicaMBean.selectedElement.zip}"/>
							<h:outputLink id="scarica-iconLink" target="_blank" styleClass="icon-compress buttonNoRed" value="#{linkZip.href}" rendered="#{not empty linkZip.href}">
							<h:outputText value="#{linkZip.label}"/>
						</h:outputLink>

						<!-- Invia Notifica EC -->
						<c:set var="linkNotificaEC" value="#{fatturaElettronicaMBean.selectedElement.notificaEC}"/>
						<a4j:commandLink id="notificaEC_btn" action="inviaNotificaEC" styleClass="buttonNoRed" rendered="#{not empty linkNotificaEC.href}" execute="@this">
							<a4j:param assignTo="#{notificaECMBean.selectedIdParam}" name="#{notificaECMBean.selectedIdParamName}" value="#{fatturaElettronicaMBean.selectedElement.DTO.id}" />
							<a4j:param assignTo="#{notificaECMBean.fromPage}" name="fromPage" value="listaFatture" />
							<h:graphicImage xmlns="" alt="" width="16" height="16" title="#{linkNotificaEC.title}" value="#{linkNotificaEC.image}"/>
							<h:outputText value="#{msg['commons.button.invia']} #{linkNotificaEC.label}"/>
						</a4j:commandLink>
					</h:form>
				</div>

			</rich:panel>

		</rich:panel>

	</ui:define>
</ui:composition>
