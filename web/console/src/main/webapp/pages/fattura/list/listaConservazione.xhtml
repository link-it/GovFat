<!-- 
  ProxyFatturaPA - Gestione del formato Fattura Elettronica 
  http://www.gov4j.it/fatturapa
  
  Copyright (c) 2014-2018 Link.it srl (http://link.it). 
  Copyright (c) 2014-2018 Provincia Autonoma di Bolzano (http://www.provincia.bz.it/). 
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
 
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
 
  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<ui:composition template="/templates/defaultTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:rich="http://richfaces.org/rich" xmlns:op2web="http://www.openspcoop2.org/web/taglib/jsf">
	<f:loadBundle var="msg" basename="messages" />
	<a4j:loadScript src="resource://jquery.js" />

	<ui:define name="pageTitle">#{msg['conservazione.listaConservazione.pageTitle']}</ui:define>
	<ui:define name="pageHeader">#{msg['conservazione.listaConservazione.pageTitle']}</ui:define>
	<ui:define name="navbar">
		<ul>
			<li><h:outputText value="/#{msg['menu.group.operazioni']}" /></li>
			<li><h:outputText value="/#{msg['conservazione.listaConservazione.pageTitle']}" /></li>
		</ul>
	</ui:define>
	<ui:define name="body">
		<a4j:keepAlive beanName="conservazioneMBean" ajaxOnly="true" />
		<style>
			div.errorsSpacer {
			    height: 4px;
			}
			.rich-mpnl-controls {
				top: 6px;
				right: 6px;
			}
		</style>
		<script type="text/javascript">
		//<![CDATA[
			jQuery(document).ready(function() {
				conservazioneTable_dt_disabilitaEsporta_2('inviaConservazione-iconLink',true);
			 });
			 //]]>
		</script>
		<rich:panel styleClass="noborder" id="pagina">
		
			<op2web:searchForm searchBean="#{conservazioneMBean.search}">
		
				<op2web:searchFields nomiFields="#{'anno,tipoFattura,ente,statoInvio'}"    />
				
				<ui:define name="buttons">
					<a4j:commandButton id="filtraButton"
						value="#{msg['commons.button.filtra']}" styleClass="icon-refresh"
						reRender="conservazioneTable" status="mainStatus" action="#{conservazioneMBean.filtra}">
					</a4j:commandButton>
		
					<a4j:commandButton id="pulisciButton"
						value="#{msg['commons.button.reset']}" reRender="#{conservazioneMBean.search.id}_searchPnl,conservazioneTable"
						status="mainStatus" styleClass="icon-delete" action="#{conservazioneMBean.reset}">
					</a4j:commandButton>
					
				</ui:define>
			</op2web:searchForm>	
			<rich:spacer height="20"/>
			
			<op2web:managedPagedListView  value="#{conservazioneDM}" mBean="#{conservazioneMBean}" >
			
            	<rich:column align="center" width="30" id="ckbClmn_2" rendered="#{not empty mBean}">
      	        	<f:facet name="header">
		                <h:panelGroup style="width:30px;" layout="block">
		                	<script type="text/javascript" >
		                  	//<![CDATA[
		                    	function #{id}_checkAllCheckboxesInTable_2( inputId, state ){
		                              var size = 0;
		                              var tid = ":"+inputId+"_tbl";
		                              if(state){
		                                  size = jQuery("table [id$='"+tid+"'] input:checkbox[id$='#{id}_column_ckb_2']").not("[id$='selectedAllChbx_2']").attr("checked","on").size();
		                                  #{id}_disabilitaEsporta_2('inviaConservazione-iconLink',false);
		                              }else{
		                                  jQuery("table [id$='"+tid+"'] input:checkbox[id$='#{id}_column_ckb_2']").removeAttr("checked");
		                                  #{id}_disabilitaEsporta_2('inviaConservazione-iconLink',true);
		                                  size=0;
		                              }
		
		                              if(true){
		                                  var _totRows = #{value.rowCount};
		                                  var _rows = #{rowsToDisplay};
		                                  if(state && _totRows>_rows ){
		                                          var t1= formatMessage("#{commonsMsg['pagedDataTable.script.checkAllCheckboxesInTable.selezionati']}",{0:size,1:_totRows});
		                                          jQuery("[id$='"+inputId+"_selectedInfoLbl']").show().text(t1);
		                                          var t2= formatMessage("#{commonsMsg['pagedDataTable.script.checkAllCheckboxesInTable.selezionaTutti']}",{0:_totRows});
		                                          jQuery("[id$='"+inputId+"_selectAllLink']").show().text(t2);
                                          }else{
                                                  jQuery("[id$='"+inputId+"_selectedInfoLbl']").hide();
                                                  jQuery("[id$='"+inputId+"_selectAllLink']").hide();
                                                  jQuery("[id$='"+inputId+"_undoSelectAllLink']").hide();                         
                                          }
                                      }
		                     	}
                     			function #{id}_selectAllListener_2(inputId, selectAll){
		                          	var _totRows = #{value.rowCount};
		                          	var tid = ":"+inputId+"_tbl";
	                                if(selectAll){
	                                        jQuery("[id$='"+inputId+"_selectedAllChbx_2']").attr("checked","on");
	                                        var t1 = formatMessage("#{commonsMsg['pagedDataTable.script.selectAllListener.selezionatiTutti']}",{0:_totRows});
	                                        jQuery("[id$='"+inputId+"_selectedInfoLbl']").show().text(t1);
	                                        jQuery("[id$='"+inputId+"_selectAllLink']").hide();
	                                        jQuery("[id$='"+inputId+"_undoSelectAllLink']").show().text("#{commonsMsg['pagedDataTable.script.selectAllListener.annullaSelezione']}.");
	                                }else{
	                                        jQuery("[id$='"+inputId+"_selectedAllChbx_2']").removeAttr("checked");
	                                        jQuery("[id$='"+inputId+"_selectedInfoLbl']").hide();
                                          	jQuery("[id$='"+inputId+"_selectAllLink']").hide();
                                         	 jQuery("[id$='"+inputId+"_undoSelectAllLink']").hide();
                                         	 //jQuery("div [id$='"+inputId+"'] input:checkbox").removeAttr("checked");
                                         	jQuery("table [id$='"+tid+"'] input:checkbox[id$='#{id}_column_ckb_2']").removeAttr("checked");
                                          	jQuery("table [id$='"+tid+"'] input:checkbox[id$='#{id}_checkAll_2']").removeAttr("checked");
                                   }
		                              
		                        }
		                        function formatMessage(text,values){
		                                    for(var v in values){
		                                              text =text.replace('{' + v + '}', values[v]);
		                                          }
		                                          return text;
                                }
		                          
		                        function #{id}_singleCheckboxListener_2( inputId, state , showSelectAll, _totRows , _rows ){
		                              //var tid = ":"+inputId+"_tbl";
		                              var tid = inputId+"_tbl";
		
		                              var allSize = jQuery("table [id$='"+tid+"'] input:checkbox[id$='"+inputId+"_column_ckb_2']").not("[id$='selectedAllChbx_2']").size();
		                              var size = jQuery("table [id$='"+tid+"'] input:checkbox[id$='"+inputId+"_column_ckb_2']:checked").not("[id$='selectedAllChbx_2']").size();
		                              
		                              if(size > 0){
		                            	  #{id}_disabilitaEsporta_2('inviaConservazione-iconLink',false);
		                              } else {
		                            	  #{id}_disabilitaEsporta_2('inviaConservazione-iconLink',true);
		                              }
		                              
		                              
		                              if(showSelectAll){
			                             if(state && _totRows>_rows ){
		                                     if(size >= allSize){
	                                             jQuery("table [id$='"+tid+"'] input:checkbox[id$='"+inputId+"_checkAll_2']").attr("checked","on");
	                                             var t1= formatMessage("#{commonsMsg['pagedDataTable.script.checkAllCheckboxesInTable.selezionati']}",{0:size,1:_totRows});
	                                             jQuery("[id$='"+inputId+"_selectedInfoLbl']").show().text(t1);
	                                             var t2= formatMessage("#{commonsMsg['pagedDataTable.script.checkAllCheckboxesInTable.selezionaTutti']}",{0:_totRows});
		                                         jQuery("[id$='"+inputId+"_selectAllLink']").show().text(t2);
		                                     }
			                             }else{
			                                     jQuery("[id$='"+inputId+"_selectedInfoLbl']").hide();
			                                     jQuery("[id$='"+inputId+"_selectAllLink']").hide();
			                                     jQuery("[id$='"+inputId+"_undoSelectAllLink']").hide();
			                                     jQuery("[id$='"+inputId+"_selectedAllChbx_2']").removeAttr("checked");
			                                     jQuery("table [id$='"+tid+"'] input:checkbox[id$='"+inputId+"_checkAll_2']").removeAttr("checked");
			                                     
			                             }
			                         }
			                     }
		                     
		                        function #{id}_disabilitaEsporta_2( inputId, abilita ){
		                        	 jQuery("[id$='"+inputId+"']").attr('disabled',abilita);
		                        }
		                        
		                        function checkSelection2(containerId){
		                            var name = containerId + "_checkSelection";
		                            var n = jQuery("div [id$='"+containerId+"_tbl'] input:checkbox[id$='column_ckb_2']:checked").length;
		                                   if(n==0){
		                                           Richfaces.showModalPanel(name);
		                                           return false;
		                                   }else{
		                                           return true;
		                                   }
		                    	};

		                     //]]>
		                    </script>
		                  	<h:selectBooleanCheckbox id="#{id}_checkAll_2" title="#{commonsMsg['pagedDataTable.component.selectAll']}" onclick="#{id}_checkAllCheckboxesInTable_2( '#{id}', this.checked );">
		
		                  	</h:selectBooleanCheckbox>
		                  	<h:selectBooleanCheckbox id="#{id}_selectedAllChbx_2" value="#{mBean.selectedAll}" style="display:none"/>
		                </h:panelGroup>
	                </f:facet>
                    <h:selectBooleanCheckbox id="#{id}_column_ckb_2" value="#{selectionMapTarget}" disabled="false" onclick="#{id}_singleCheckboxListener_2( '#{id}', this.checked , true ,#{value.rowCount} , #{rowsToDisplay} );"/>
                </rich:column>

				<op2web:tableColumns nomiColonne="#{'tipoFattura'}" />
				
				<rich:column styleClass="#{itemMetadata.cedentePrestatore.tableColumnStyleClass}" rendered="#{not conservazioneMBean.search.ricercaFattureAttive}">
					<f:facet name="header">
						<h:outputText value="#{itemMetadata.cedentePrestatore.label}" rendered="#{not empty itemMetadata.cedentePrestatore.label}" styleClass="#{itemMetadata.cedentePrestatore.labelStyleClass}" />
					</f:facet>
			
					<h:outputText id="#{itemMetadata.cedentePrestatore.name}Value" value="#{item.cedentePrestatore.value}" styleClass="#{itemMetadata.cedentePrestatore.valueStyleClass}"
						rendered="#{not empty item.cedentePrestatore.value}"/>
				</rich:column>
				
				<rich:column styleClass="#{itemMetadata.cessionarioCommittente.tableColumnStyleClass}" rendered="#{conservazioneMBean.search.ricercaFattureAttive}">
					<f:facet name="header">
						<h:outputText value="#{itemMetadata.cessionarioCommittente.label}" rendered="#{not empty itemMetadata.cessionarioCommittente.label}" styleClass="#{itemMetadata.cessionarioCommittente.labelStyleClass}" />
					</f:facet>
			
					<h:outputText id="#{itemMetadata.cessionarioCommittente.name}Value" value="#{item.cessionarioCommittente.value}" styleClass="#{itemMetadata.cessionarioCommittente.valueStyleClass}"
						rendered="#{not empty item.cessionarioCommittente.value}"/>
				</rich:column>
				
				
				<!-- Colonne destinatario,identificativoSDI, annonumero, dataInvio-->
				<op2web:tableColumns nomiColonne="#{'dipartimento,identificativoSdi,annoNumero,dataInvio'}" />
				
				<!-- Stato Invio (Icona) -->
				<rich:column style="text-align: center;">
					<f:facet name="header">
						<h:outputText value="#{itemMetadata.statoInvio.label}" />
					</f:facet>
					 
					<h:panelGroup>
						<h:graphicImage value="#{item.statoInvio.image}" width="16" height="16"	title="#{item.statoInvio.title}"  alt="#{item.statoInvio.alt}"
								 rendered="#{item.statoInvio.rendered == true}" />
						<h:graphicImage value="/images/s.gif" width="1" height="1" alt="spacer" rendered="#{item.statoInvio.rendered == false}" />
					</h:panelGroup>
				</rich:column>
					
				<!-- XML (Icona) -->
				<rich:column style="text-align: center;">
					<f:facet name="header">
						<h:outputText value="#{itemMetadata.xml.label}" />
					</f:facet>
					 
					<h:panelGroup>
					 	<h:commandLink id="visualizzaXmlLink" target="_blank" action="#{item.visualizzaXml}" rendered="#{not empty item.xml.href}">
							<h:graphicImage value="#{item.xml.image}" width="16" alt="#{item.xml.alt}" height="16"	title="#{item.xml.title}" />
						</h:commandLink>
						<h:graphicImage value="/images/s.gif" width="1" height="1" alt="spacer" rendered="#{empty item.xml.href}" />
					</h:panelGroup>
				</rich:column>
				
				<ui:define name="buttonsListView">
					<a4j:commandButton	id="inviaConservazione-iconLink" 
						styleClass="icon-fatturapa-up-green"  action="#{conservazioneMBean.inviaFattureInConservazione}"
						status="mainStatus" value="#{msg['conservazione.button.inviaConservazione']}" 
					 style="color: #dd2c0d; padding: 4px 6px 4px 5px;">
					</a4j:commandButton>
				</ui:define>
			</op2web:managedPagedListView>
		</rich:panel>
	</ui:define>
</ui:composition>
