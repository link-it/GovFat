<!-- 
  ProxyFatturaPA - Gestione del formato Fattura Elettronica 
  http://www.gov4j.it/fatturapa
  
  Copyright (c) 2014-2015 Link.it srl (http://link.it). 
  Copyright (c) 2014-2015 Provincia Autonoma di Bolzano (http://www.provincia.bz.it/). 
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
 
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
 
  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<ui:composition template="/templates/defaultTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:rich="http://richfaces.org/rich" xmlns:op2web="http://www.openspcoop2.org/web/taglib/jsf">
	<f:loadBundle var="msg" basename="messages" />
	<a4j:loadScript src="resource://jquery.js" />

	<ui:define name="pageTitle">#{msg['fattura.listaFatture.pageTitle']}</ui:define>
	<ui:define name="pageHeader">#{msg['fattura.listaFatture.pageTitle']}</ui:define>
	<ui:define name="navbar">
		<ul>
			<li><h:outputText value="/#{msg['menu.group.operazioni']}" /></li>
			<li><h:outputText value="/#{msg['fattura.listaFatture.pageTitle']}" /></li>
		</ul>
	</ui:define>
	<ui:define name="body">
		<a4j:keepAlive beanName="fatturaElettronicaMBean" ajaxOnly="true" />
		<rich:panel styleClass="noborder" >

			<op2web:form formBean="#{fatturaElettronicaMBean.search}" >
				
				<op2web:fieldset legend="#{msg['fattura.search.datiTrasmissione']}" rendered="#{true}" collapsible="false" closed="false">
				
					<op2web:formField field="#{fatturaElettronicaMBean.search.cedentePrestatore}" />
					<op2web:formField field="#{fatturaElettronicaMBean.search.identificativoLotto}"    />
					<op2web:formField field="#{fatturaElettronicaMBean.search.dipartimento}"   />
					<op2web:formField field="#{fatturaElettronicaMBean.search.dataRicezionePeriodo}"   />
					<op2web:formField field="#{fatturaElettronicaMBean.search.dataRicezione}"    />
				</op2web:fieldset>
					
				<op2web:fieldset legend="#{msg['fattura.search.datiFattura']}" rendered="#{true}" collapsible="false" closed="false">
					<op2web:formField field="#{fatturaElettronicaMBean.search.numero}" />
					<op2web:formField field="#{fatturaElettronicaMBean.search.dataEsatta}" />
					<op2web:formField field="#{fatturaElettronicaMBean.search.tipoDocumento}" />
				</op2web:fieldset>
					
				<op2web:fieldset legend="#{msg['fattura.search.statoFattura']}" rendered="#{true}" collapsible="false" closed="false">	
					<op2web:formField field="#{fatturaElettronicaMBean.search.notificaEsitoCommittente}" />
					<op2web:formField field="#{fatturaElettronicaMBean.search.notificaDecorrenzaTermini}" />
				</op2web:fieldset>
				<ui:define name="buttons">
						<a4j:commandButton id="filtraButton"
							value="#{msg['commons.button.filtra']}" styleClass="icon-refresh"
							reRender="mainct,menuct" status="mainStatus"
							action="#{fatturaElettronicaMBean.filtra}">
						</a4j:commandButton>

						<a4j:commandButton id="pulisciButton"
							value="#{msg['commons.button.reset']}" reRender="mainct,menuct"
							status="mainStatus" styleClass="icon-delete"
							action="#{fatturaElettronicaMBean.resetFiltro}">
						</a4j:commandButton>
				</ui:define>

			</op2web:form>
						
			<br />
			<br />

		<c:if test="#{empty rowsToDisplay}">
			<c:set var="rowsToDisplay" value="#{fatturaElettronicaMBean.search.pageSize}" />
		</c:if>

		<a4j:outputPanel id="panelContainer" ajaxRendered="false" layout="block">
			<h:form>
			
				<c:set var="fatturaMetadata" value="#{fatturaElettronicaMBean.metadata}" />
			
				<op2web:dataTable value="#{fatturaElettronicaDM}" id="fatturaElettronicaTable" enableDelete="false"
					headerText="#{msg['fattura.label.ricercaFatture.tabellaRisultati']}" showSelectAll="true"
					selectionMapTarget="#{fatturaElettronicaMBean.selectedIds[item]}"
					rowsToDisplay="#{fatturaElettronicaMBean.search.pageSize}" mBean="#{fatturaElettronicaMBean}">
					<f:facet name="noData">
						<h:outputText value="#{msg['fattura.label.ricercaFatture.tabellaRisultati.noData']}" />
					</f:facet>
					
					<!-- Mittente -->
					<op2web:tableColumn fieldValue="#{item.cedentePrestatore}" fieldDescriptor="#{fatturaMetadata.cedentePrestatore}" />
					
					<!-- Destinatario -->
					<op2web:tableColumn fieldValue="#{item.dipartimento}" fieldDescriptor="#{fatturaMetadata.dipartimento}" />
					
					<!-- identificativoSdi -->
					<op2web:tableColumn fieldValue="#{item.identificativoSdi}" fieldDescriptor="#{fatturaMetadata.identificativoSdi}" />
					
					<!-- AnnoNumero -->
					<op2web:tableColumn fieldValue="#{item.annoNumero}" fieldDescriptor="#{fatturaMetadata.annoNumero}" />
					
					<!-- Data -->
					<op2web:tableColumn fieldValue="#{item.data}" fieldDescriptor="#{fatturaMetadata.data}"  />					

					<!-- Data Ricezione -->
					<op2web:tableColumn fieldValue="#{item.dataRicezione}" fieldDescriptor="#{fatturaMetadata.dataRicezione}"  />
					
					<!-- Importo -->
					<op2web:tableColumn fieldValue="#{item.importo}" fieldDescriptor="#{fatturaMetadata.importo}" />
					
					<!-- Notifica EC (Icona) -->
					<rich:column style="text-align: center;">
						<f:facet name="header">
							<h:outputText value="#{fatturaMetadata.notificaEC.label}" />
						</f:facet>
 					 
 					 	<h:panelGroup>
							<h:graphicImage value="/images/fatturapa/icons/${item.notificaEC.icon}" width="16"
									height="16"	title="#{item.notificaEC.iconTitle}"  alt="#{item.notificaEC.alt}"
									  rendered="#{empty item.notificaEC.link}"/>
						
							<a4j:commandLink id="notificaEC_btn" action="inviaNotificaEC"
							 rendered="#{not empty item.notificaEC.link}" ajaxSingle="true">
								<f:setPropertyActionListener value="#{item}"
									target="#{notificaECMBean.fattura}" />
									<f:setPropertyActionListener value="listaFatture"
									target="#{notificaECMBean.fromPage}" />
								<h:graphicImage value="/images/fatturapa/icons/${item.notificaEC.icon}" width="16"
									height="16" title="#{item.notificaEC.iconTitle}" alt="#{item.notificaEC.alt}" />
							</a4j:commandLink>
						</h:panelGroup>
 					</rich:column>
 					
 					<!-- Notifica DT (Icona) -->
					<rich:column style="text-align: center;">
						<f:facet name="header">
							<h:outputText value="#{fatturaMetadata.notificaDT.label}" />
						</f:facet>
 					 
 					 	<h:panelGroup >
							<h:graphicImage value="/images/fatturapa/icons/${item.notificaDT.icon}" width="16" alt="#{item.notificaDT.alt}"
									height="16"	title="#{item.notificaDT.iconTitle}" rendered="#{item.notificaDT.rendered == true}" />
							<h:graphicImage value="/images/s.gif" width="1" height="1" alt="spacer"
							 rendered="#{item.notificaDT.rendered == false}" />
						</h:panelGroup>
						
 					</rich:column>
					
					<!-- XML (Icona) -->
					<rich:column style="text-align: center;">
						<f:facet name="header">
							<h:outputText value="#{fatturaMetadata.xml.label}" />
						</f:facet>
 					 
 					 	<h:panelGroup>
 					 	<h:commandLink 
 					 		id="visualizzaXmlLink" target="_blank" action="#{item.visualizzaXml}"
								  rendered="#{not empty item.xml.link}">
							<h:graphicImage value="/images/fatturapa/icons/${item.xml.icon}" width="16" alt="#{item.xml.alt}"
									height="16"	title="#{item.xml.iconTitle}" />
						</h:commandLink>
						</h:panelGroup>
 					</rich:column>
					
					<!-- PDF (Icona) -->
					<rich:column style="text-align: center;">
						<f:facet name="header">
							<h:outputText value="#{fatturaMetadata.pdf.label}" />
						</f:facet>
 					 
 					 	<h:panelGroup>
 					 	<h:commandLink 
 					 		id="visualizzaPdfLink" target="_blank" action="#{item.visualizzaPdf}"
								  rendered="#{not empty item.pdf.link}">
							<h:graphicImage value="/images/fatturapa/icons/${item.pdf.icon}" width="16"
									height="16"	title="#{item.pdf.iconTitle}" alt="#{item.pdf.alt}" />
						</h:commandLink>
						</h:panelGroup>
 					</rich:column>
					
					<!-- Link dettagli -->
					<rich:column style="text-align: center;">
						<h:panelGroup>
							<a4j:commandLink id="dettaglio_btn" action="dettaglio"
								ajaxSingle="true">
								<f:setPropertyActionListener value="#{item}"
									target="#{fatturaElettronicaMBean.selectedElement}" />
								<h:graphicImage value="/images/magnifier.png" width="16" alt="#{msg['fattura.label.ricercaFatture.dettaglioTitle']}"
									height="16" title="#{msg['fattura.label.ricercaFatture.dettaglioTitle']}" />
							</a4j:commandLink>
						</h:panelGroup>
					</rich:column>
					
					<ui:define name="buttons">
						<h:panelGrid columns="2">
							<h:commandLink id="exportFatture-iconLink" target="_blank"
								styleClass="icon-compress" action="#{fatturaElettronicaMBean.exportSelected}"
								onclick="return checkSelection('fatturaElettronicaTable');" style="color: #dd2c0d">
								<h:outputText value="#{msg['commons.button.esporta']}" />
							</h:commandLink>
						</h:panelGrid>
					</ui:define>
				</op2web:dataTable>

			
			</h:form>
		</a4j:outputPanel>
		</rich:panel>

	</ui:define>


</ui:composition>
