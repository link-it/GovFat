<!-- 
  ProxyFatturaPA - Gestione del formato Fattura Elettronica 
  http://www.gov4j.it/fatturapa
  
  Copyright (c) 2014-2015 Link.it srl (http://link.it). 
  Copyright (c) 2014-2015 Provincia Autonoma di Bolzano (http://www.provincia.bz.it/). 
  
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
 
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
 
  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<ui:composition template="/templates/defaultTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:op2web="http://www.openspcoop2.org/web/taglib/jsf">
	<f:loadBundle var="msg" basename="messages" />

	<ui:define name="pageTitle">#{msg['ente.dettaglio.pageTitle']}</ui:define>
	<ui:define name="pageHeader">#{msg['ente.dettaglio.pageTitle']}</ui:define>
	<ui:define name="navbar">
		<ul>
			<li><h:outputText value="/#{msg['menu.group.anagrafica']}" /></li>
			<li><h:outputText
					rendered="#{enteMBean.selectedElement.DTO.id != -1}"
					value="/#{msg['ente.dettaglio.pageTitle']} (#{enteMBean.selectedElement.nome.value})" /></li>
			<li><h:outputText
					rendered="#{enteMBean.showForm == true and enteMBean.azione == 'update'}"
					value="/#{msg['commons.button.aggiorna']}" /> <h:outputText
					rendered="#{enteMBean.showForm == true and enteMBean.azione != 'update'}"
					value="/#{msg['commons.button.nuovo']}" /></li>
		</ul>
	</ui:define>
	<ui:define name="body">

		<a4j:keepAlive beanName="enteMBean" ajaxOnly="true" />
		<c:set var="registroMBean" value="#{enteMBean.registroMBean}" />

		<rich:panel id="panelContainer1" style="padding:0"
			headerClass="outpanelHeader" styleClass="noborder">
			<h:outputText id="outNoDettaglio"
				value="#{msg['ente.dettaglio.nodata']}"
				rendered="#{empty enteMBean.selectedElement and enteMBean.azione == 'update'}" />

			<rich:panel id="panelDettaglioForm1" bodyClass="inpanelBody"
				rendered="#{not empty enteMBean.selectedElement and enteMBean.showForm == true}">
				<f:facet name="header">
					<h:outputText id="outHeaderEnteFr1"
						value="#{msg['ente.dettaglio.pageTitle']} (#{enteMBean.selectedElement.nome.value})"
						rendered="#{not empty enteMBean.selectedElement}" />
				</f:facet>
				<!-- Form Inserimento dati -->
				<op2web:form formBean="#{enteMBean.form}"
					rendered="#{enteMBean.showForm  == true}">
					<p class="legend">
						<strong>#{msg['commons.label.note']}</strong> (<em>*</em>)
						#{msg['commons.label.campiObbligatori']}
					</p>
					<op2web:fieldset legend="#{msg['ente.form.label']}"
						collapsible="false" closed="false" rendered="#{true}">

						<!-- Nome-->
						<op2web:formField field="#{enteMBean.form.nome}" />

						<!-- Descrizione -->
						<op2web:formField field="#{enteMBean.form.descrizione}" />

						<!-- Endpoint -->
						<op2web:formField field="#{enteMBean.form.endpoint}" />


					</op2web:fieldset>
					<br />

					<ui:define name="buttons">
							<a4j:commandButton id="invia"
								value="#{msg['commons.button.invia']}" styleClass="icon-save"
								reRender="mainct,menuct" status="mainStatus"
								action="#{enteMBean.invia}">
							</a4j:commandButton>

							<a4j:commandButton id="annulla"
								value="#{msg['commons.button.annulla']}" status="mainStatus"
								styleClass="icon-delete" action="#{enteMBean.annulla}"
								reRender="mainct,menuct">
							</a4j:commandButton>
					</ui:define>

				</op2web:form>
			</rich:panel>

			<rich:panel id="panelDettaglio1" bodyClass="inpanelBody"
				rendered="#{not empty enteMBean.selectedElement and enteMBean.showForm == false}">
				<f:facet name="header">
					<h:outputText id="outHeaderFattura1"
						value="#{msg['ente.dettaglio.pageTitle']} (#{enteMBean.selectedElement.nome.value})"
						rendered="#{not empty enteMBean.selectedElement}" />
				</f:facet>

				<!-- Messaggio Idp -->
				<h:panelGrid id="panelDettaglio2"
					columnClasses="gridContent verticalAlignTop"
					rendered="#{!empty enteMBean.selectedElement}" columns="1"
					width="100%">

					<!-- Dati Generali  -->
					<op2web:fieldset legend="#{msg['ente.label.generale']}"
						rendered="#{true}">
						<op2web:outputGroup
							group="#{enteMBean.selectedElement.fieldsDatiGenerali}" />
					</op2web:fieldset>

					<br />

					<h:form id="formShowUpdateForm">
						<div class="buttonrow">
							<a4j:commandButton id="aggiorna" value="#{msg['ente.modifica']}"
								styleClass="icon-edit" status="mainStatus"
								action="#{enteMBean.modifica}" reRender="mainct,menuct">
							</a4j:commandButton>
						</div>
					</h:form>

					

				</h:panelGrid>
			</rich:panel>

			<br />
			<br />

			<rich:panel id="panelRegistri1" bodyClass="inpanelBody"
				rendered="#{not empty enteMBean.selectedElement and enteMBean.showForm == false}">
				<f:facet name="header">
					<h:outputText id="outHeaderRegistri11"
						value="#{msg['ente.label.registri']}"
						rendered="#{not empty enteMBean.selectedElement}" />
				</f:facet>

				<!--Registri -->
				<c:if test="#{empty rowsToDisplay}">
					<c:set var="rowsToDisplay" value="#{enteMBean.search.pageSize}" />
				</c:if>

				<h:form>

					<c:set var="registroMetadata" value="#{registroMBean.metadata}" />

					<op2web:dataTable value="#{registroDM}" id="registroTable"
						enableDelete="true"
						headerText="#{msg['registro.tabellaRisultati.label']}"
						showSelectAll="true"
						selectionMapTarget="#{registroMBean.selectedIds[item]}"
						rowsToDisplay="#{registroMBean.search.pageSize}"
						mBean="#{registroMBean}">
						<f:facet name="noData">
							<h:outputText value="#{msg['registro.tabellaRisultati.noData']}" />
						</f:facet>

						<!-- Descrizione -->
						<op2web:tableColumn fieldValue="#{item.nome}"
							fieldDescriptor="#{registroMetadata.nome}" />

						<!-- Codice -->
						<op2web:tableColumn fieldValue="#{item.username}"
							fieldDescriptor="#{registroMetadata.username}" />

						<!-- Link dettagli -->
						<rich:column style="text-align: center;">
							<h:panelGroup>
								<a4j:htmlCommandLink id="dettaglio_btn" action="registro"
									ajaxSingle="true">
									<f:setPropertyActionListener value="#{item.DTO.id}"
										target="#{registroMBean.selectedId}" />
									<h:graphicImage value="/images/magnifier.png" width="16"
										height="16" title="#{msg['registro.dettaglioTitle']}" alt="#{msg['registro.dettaglioTitle']}" />
								</a4j:htmlCommandLink>
							</h:panelGroup>
						</rich:column>

						<ui:define name="buttons">
							<h:commandButton id="aggiungi" styleClass="icon-add"
								value="#{msg['commons.button.nuovo']}" action="registro"
								actionListener="#{registroMBean.addNewListener}" />
						</ui:define>
					</op2web:dataTable>


				</h:form>


			</rich:panel>

		</rich:panel>

	</ui:define>
</ui:composition>